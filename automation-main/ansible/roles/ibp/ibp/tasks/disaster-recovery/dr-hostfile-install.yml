---
# Synopsis: Adds hostfile for disaster recovery instances
# Inputs:
#   - ansible_new_dr: Group var generated by the ibp-dr-rebuild playbook.
# Outputs: Hostfile for disaster recovery (az1b) systems
# Comments: N/A

- name: "Initialize sidlist"
  set_fact:
    sidlist: []

- name: "Set facts for hostfile"
  set_fact:
    sidlist: "{{ sidlist + [ hostvars[groups.ansible_new_dr|intersect(groups.ibpapp)|first].sid ] }}"
    cpids_ipaddress: "{{ groups.ansible_new_dr|intersect(groups.cpids)|first }}"
    webdispatcher_ipaddress: "{{ groups.ansible_new_dr|intersect(groups.webdispatcher)|first }}"
    production_sid: "{{ hostvars[groups.ansible_new_dr|intersect(groups.ibpapp)|first].sid }}"
    production_suffix: "{{ hostvars[groups.ansible_new_dr|intersect(groups.disaster_recovery)|first].suffix }}"

- name: update /etc/hosts file
  template:
    dest: /etc/hosts
    src: "provisioning/ibp-hostfile-dr.j2"
    backup: yes
  become: yes
...
---
# Description: Configures Apt and performs other pre-configuration tasks for Debian based systems.
# Inputs:
#   - repo_force: (bool) Whether to force the re-downloading of the repository file and the re-enabling of the repositories within it.
#   - repo_delete: (bool) Whether to remove all repositories and repository files that were setup by this Ansible role.
#   - repo_apt_signing_keys: (list) A list of Apt repository signing keys to enable on Debian-based systems.
# Outputs:
#   - Removes previously downloaded sources.list repository files if 'repo_force' or 'repo_delete' are set to true

  - name: "[Ubuntu] - Ensure that the '/etc/apt/sources.list.d' directory is present"
    file:
      state: directory
      path: /etc/apt/sources.list.d
      owner: root
      group: root
      mode: '0755'
    become: true
    when: repo_delete | bool == false

  - name: '[Ubuntu] - Remove the previously created sources.list repository file'
    file:
      state: absent
      path: /etc/apt/sources.list.d/ansible-managed-repository-management.list
    become: true
    when: repo_force | bool or repo_delete | bool

  - name: '[Ubuntu] - Add the necessary Apt repository signing keys to the system'
    apt_key:
      state: present
      data: '{{ item.public_key }}'
      keyring: /etc/apt/trusted.gpg.d/'{{ item.keyname }}'.gpg
    become: true
    loop: '{{ repo_apt_signing_keys }}'

...

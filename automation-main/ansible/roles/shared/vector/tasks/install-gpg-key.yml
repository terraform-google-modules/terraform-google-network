---
# Install the Vector public key for verification purposes during installation

  - name: Install the Vector RPM GPG key for validation
    ansible.builtin.copy:
      dest: /tmp/DATADOG_RPM_KEY_CURRENT.public
      content: |
        -----BEGIN PGP PUBLIC KEY BLOCK-----

        mQINBF9XPv4BEAC2jpAwg08DflFs6zn7aF7krQquT9a3Eq7jK1Rz5eRj6t5pcsfW
        LZ3r+XvqEL6h2Asayigkg2a6/QZD+GWCyQgaAj6SnqpbG0t9QUiNveBWahPi4PTK
        cRxhso9VbtBD2KMaGKxEs7pA2ltq5J9H/WKHRWnY4xgehRDT0zyhOUhuvKDQnFHA
        n2qYeDUuVnGbQ8z6+4782YHxg02HJwYDLJ719jZFlmt2fENS2o+uqZgR+lljYwhy
        rO7N+u28zvFoKXB99Dt9mIxQJiU+7skwmZYkgj0Ul5995/5LqdCeNUxSr5/olHcX
        SpL9eyJ3Ny/gwmyaQFqrZ48Z8RsaXyoluL4D1PmworUQ2qEMOow0911B0SxGW0ez
        jWbur6E6TeGd24OMijZ/ymTl2DEEx2aiqSbfB83QBZtRR+FCMdG/JCzLeUcShfg2
        dLdoIk0d7BUnIH1Z7mLlbSfnLcSEylLzdcCWT6jUa8gTQUIr4l6uOSDneph2n41A
        a8J+ob6QXUtZ6BkZrSTt0KsZMqVaqpNhoT+O1hXnMJ/0qk/L7UTRpUWFRdyo3Yv5
        mKo1fwHswrYG65rftJUxl9VHYggsspMYeH3b3zzN8PRUF1F+M6FoY/cKD48KeWFl
        9mZ2UUrdjSculNXslV4UXcTKQgEtsOTL/xq15De6Ju5LGSySUUtTXLdk8wARAQAB
        tEFEYXRhZG9nLCBJbmMuIFJQTSBrZXkgKDIwMjAtMDktMDgpIDxwYWNrYWdlK3Jw
        bWtleUBkYXRhZG9naHEuY29tPokCVAQTAQoAPhYhBMZVm2kMqILwI73z9j9NFyn9
        S/kVBQJfVz7+AhsDBQkHhM4ABQsJCAcCBhUKCQgLAgQWAgMBAh4BAheAAAoJED9N
        Fyn9S/kVBtkP/1v2pkB9Axpkj+0lDC2WfHQWpWZuNU0RLgPUO1cLgVQwn04R9GO7
        s2kcLWN3oJaGIXgpe8nKa9Ui7w6f3E6z1NjPSQfp7nTxeht0+cSW4AO3BqYPJpan
        RXKwW1cCZ8ajX9ZMfFc0H7r+xkDWOJpikzaukWNujDojLxZPsJvWilOepDae9bBi
        7KIcqwuc/5jciMuiZ72eI5qPWMqY59Nmqkt15FVPTZudBsZuocaPAqkrOAJojZCL
        06vH6Nn4EZvW5VtH4eYqGfIM6vWIlBp9ya2o2nQeSaN1CveUZ7kOrFkMSBWGMywO
        54SmqMtuxkvNF+yMqnRv1vL6TCtGPcCS5k/YAeCmgqPiSpzEc+rjc/HDmBDJanh9
        xCkL25CDfr30H/69xY1urZLCLZk7DBmTS9htaIc0onru6NGieYQC846wxTGebUat
        rmInYXEvYS1fO3Lrbc1hJULkDydw27HeV8pHMSl3gRNC1O5Za96Yu4bsa+CePtk/
        0DXVK9CT5QZg7CPpJXUXAmM2HLan+v34v5CKyfqPm/HutMTzSGjf2LHLTxc3aoCe
        Q6+bPjnzRqcIHzAi0njqbX6iHLg3n7+il0ZRbEResseB6z/zKLw2hXtHtfd3HDav
        NxRZi57WTsRvEeWSJtRuIW7GCuFXjQApH6izo05HUaiuFJzyJwfLsbd5iQIzBBAB
        CgAdFiEE11zqFwSLmsvxhnlLMmN9RPFPYg4FAl9XPwoACgkQMmN9RPFPYg7CTA/7
        BzhhuosqK02GBczG/ykjM7d7dUYTnU9ksQBtLbAnnBh9MsOBOyDSoz5gh20CSqDK
        oe0ZL1nB151EcgCjvP0EC9NysaHEnT7sj9SGLHpOGjmguSxIlzd0jSB6gKzNfGZE
        pg6N7uvZEq8V5GEn6imMqQkIIfPz712lTVJIgQTD0iL9YxsD1VlgBQY6rrENXYC8
        nKzTVVg9xEbIzO1sBlh4dIR+3WmusDNy54Ag6t9/t5Eovk7AZWnQ3dA8Z7kpKnIg
        G95rsO5FMvduKYiaeJ+PNBs6u3Zehohe0lc4XReg6Q+vtxfhbTqjy4KznP7CAlux
        FuFxvG+soKA+PQFyuPIPBd0YLSZ3v72ypujj5Ibp0UHq+3bW3NorF4FX5pO39rxj
        O3Z9Y71FeqvZ9YTfG7M6tLTgkt+LlOi9rs2EY0BFakEY6RAvF4gcpKOqoVVB77f8
        tjWVsSk3qDPckn5rn/NgWViyqT+EMPff76XSZyi4zsPRFQycc9q6GcyHiQrS2IvO
        WRHNEE4U26LZywY8yKbJR0uZL3WIRZQZa/6BnoKkcI/A2mqjnUe8xkynXEyEye9H
        PvhGNvNW2K38G7rzwKzB5Q/1bHAKvVI9zCNUvUMBOcnMdWtMAQ+ldqHgK0A36RH2
        LS637R1dAZoDZdHjJzBuBCrscdqD8AyYlRo6lIcBO38=
        =8Ypd
        -----END PGP PUBLIC KEY BLOCK-----
      mode: '0644'
    register: vector_rpm_gpg_key
    when:
      - ansible_os_family | lower == "redhat" or ansible_os_family | lower == "suse"

  - name: Import Vector RPM GPG key
    ansible.builtin.shell: |
      rpm --import /tmp/DATADOG_RPM_KEY_CURRENT.public
    when:
      - ansible_os_family | lower == "redhat" or ansible_os_family | lower == "suse"
      - vector_rpm_gpg_key.changed

  - name: Install the Vector APT GPG key for validation
    ansible.builtin.copy:
      dest: /tmp/DATADOG_APT_KEY_CURRENT.public
      content: |
        -----BEGIN PGP PUBLIC KEY BLOCK-----

        xsFNBF9XPZkBEAC1DM+rBW2gJlMBqczbTtdiF16dg9xStMk3ZRQKKWoq5vndznNI
        y+giehP4zanhi+BkpdvPdfh81r3eAquPI+t4VdNMkGrXxvAt2TyumXrM0VBVmFT3
        Qutu1NpLd4EBdYOqAco/eBPUxoNyvM57KFeA/mhkxgteRDfUOleq+f9gBHPtMbYK
        z7iBm5w5lQyTXIEKwmDwtO08RRf1liuSKv/SEu3zGmuSsHZoqyZN654179qZNifc
        IS0GCuEMFVPs2s5NWJbAl77+Sm3pWgG1fBTS8hy8nUrxDP+xUHhsDKoiccXGhKD7
        x/y3Y5V+fGUKYj1TJHRqlMB+bAiBOd9uLMVSrzYJBLHsek/lIvARwNA8qhubjgFf
        0qi31a0YWq5R05SPuoU9Wsyivt2wmu6sTxjvGdpQYwTFwE3s8Wwzwr1sx9NiK/yG
        /AnDQsOCrAhv7yiB2VrN//XnAhoNrKmn10892jrcQl7rfzRr9J9qVGs+8BcUcbrH
        dPsAo4tYnWYWUF2/I6Ucp9Z+7QfVgkm6Eex69HOTWTOLp9kGT28MQeMzW2fGN2fR
        ReAwAPGu78AeJBOgS4W4YoFU3W1m11wXiL4qeHYx29mvZ7D/38HaRgGf0lTNJH6Y
        OYgbPl4tQPj1VcMXAa1vd2P/5c4WkBjUIALfHV35/LVkPVvp0kQ3stRQqQARAQAB
        zUdEYXRhZG9nLCBJbmMuIE1hc3RlciBrZXkgKDIwMjAtMDktMDgpIDxwYWNrYWdl
        K21hc3RlcmtleUBkYXRhZG9naHEuY29tPsLBlAQTAQoAPhYhBNdc6hcEi5rL8YZ5
        SzJjfUTxT2IOBQJfVz2ZAhsDBQkWjmoABQsJCAcCBhUKCQgLAgQWAgMBAh4BAheA
        AAoJEDJjfUTxT2IOMrwP/3Wd57co1F+EDv8nih2xzdO+CrMyMy+KjbIqNd/1YhJO
        DHby8FA1Lh9wJEhk+FgmQeehIW6OZfONJDl8QNgAuMNSNbx5gYnlOVxz7jWYULkG
        X8K2rpVSeHpP7fuho07dDPXuqK0LSnyoxqjR3iNM2S4UYUD5af/d+ZrIV8zRnMaL
        9+tEBVLebI0xVYV/2G91VgY4wacHbQwktuxycpqjiDNYY3QAoDvkSyC/LUk7jNw7
        Z/ufbdW+pHGiD0+K2cTWxpG1bNeUl0rPp6V87zIQdfsoukfMo76r9335sHMkbSOU
        vgfvSGfrdjk/0kubuIFhByxkpIkUPC79GGb92UlCMXrrXotF2h6Vj/TbvjPLT0Hp
        Y/Jx9wW/YqMVjiwNaGstpvYyeClcHyEETfoBRjGgwkF5thCW9+YGpN6jBG8ooFao
        KMAgfIE2CNh0cWYXgrH6IK1abZKZdoC5EGiUdyLaI0wRurBKlMOlC0AuDgAp+b/t
        jgs3yhwM4REGMyfatDKySSWLzK9ZkZb51y2nqC+ZS/wZ2rcoQXEOAA9YDz5qITNR
        I1WjCpTjc9CL1CXnsvLKjR7L8BwPoPpWF9am8I5oAIDcqjiKdRB9QSDJ8HZHLMfP
        6bXc4mo05qK5fkjOR/n+73W6tb1i8iu0fgg8p/ojO2tMKYEU/ujfsdsG3fSJ6S9S
        zsFNBF9XPoUBEADSTjhnwLN3spyrtGB6zZTT+WCbKa3sAu31oBlxJU1OkVHsEhDO
        4sUqTEG31vHp00N0em/udtgWZ5E+DOqrKe9aiGG4m+F3cvWejwOOW+9I2ZhVuFZ2
        YShqnSoSMezEsPxle4KVFXIMdtD1plPi+UjddhA11Oqq6UEBkuOnMvTgo0gr5Uo9
        FgMyH3UZphSSjxVNtOjl6sZto7v05VaV8Q/havHO9TDH+ksxx6jFBB0Z/wxmoisb
        lvvsxSuzGHyQXybwgtLW6I77jdGtmLMrCuNoVTi1H9ZatCuoov2MkIDtcRayKjVT
        nQRCNkEqGbNY53TU85u1b1/VM5px77fLZPMA7vm3I3+gfeFXm6zFdPxZLNDihIX7
        2aG4uM+NDm2CQbtPdwZOOexn65p/LoaJrb7Kv/NKeR4QeFFqNAzofGJn84hEuNac
        V24SNkfpEkZ5DgCN38FIaFRpaQlgoj5uxZoQxSIaiV82RfW2u6gVMupkApNeJL9A
        EVWwzpXIUGvrVAKBLKcsPiXtBzSe23o2AXa/Ak7jCKTviqoAjW2UN2rZgbqwH34M
        51rYimxhnntjJpx0+SHm+AYuiAq8JXNANkXkmQQpU0VKu3Zld9IuO7PIg22UKZ14
        1YDbyDIJoyR84HrmOMVExKhLObVEfNQoeAuuMgvVqEtOsZKPqTGEk1NIlQARAQAB
        wsOyBBgBCgAmFiEE11zqFwSLmsvxhnlLMmN9RPFPYg4FAl9XPoUCGwIFCQeEzgAC
        QAkQMmN9RPFPYg7BdCAEGQEKAB0WIQTAJDKprqRsj1ocaKXn+FTEENM8QgUCX1c+
        hQAKCRDn+FTEENM8QoJaD/9b3L7sCZIfOJ1iobkQXBu9ZQZIp/ZBF56tD6io7LbR
        exlpB0OpCdJKB7Bcxqiw6tD1mLZXU2/IlfEUaQgie9mXtRTK6XL9cKdKaktSyZ2E
        5HMZ9aCc5GEoedz74+3ZUkDak0BluN2HWOk7glJVN8gbxNpS6gTcax6iZcT4Exi2
        CxbnSOULt5/z85m8DC/P6wGrPDmKzWMlcaCCHBoV/ePChn2SlC4lWd8JQv/kAPxF
        gGH2/bWbJzyZyYFFZY8qZBipH053WCmqmeLVoouk8vM9MvqV001jFJxOhBzN91AV
        iztuH4pfNCxWwgJl+e70lV3oGLOZSW/y5YjRABrRIA0nnk4LpALA5yEQM+GgfkU8
        R7sGscyFJA92dudJlvRpyX2FxhBzt6pRm4W/oWhw4DGSaBQ//YeFM7tC3ImAweQw
        lgyBgQb2rgMnphDyXFz/VnCJCrXGax1fJ5mgL757ydGM9P+0yIm2Z4jAFPyQVQtx
        5GuhxVHhl8mCC8DTN6OL4eZHechxWYeHeNEkxttpGkrsfFh7oEZ3wsRlnbMzvOG2
        xlOhXQ3nABCz1JgFTu3gnyFajuC4NIcoxPIczN5NI6uiglYErj71HP4gRy1Kils3
        jkxJckeAYSR2ljdOSZy83/dIIMivYyvIhkqBRHn/djyOF0SkeOz11bMax4neXWx8
        GmyrD/9cq5GELY34nKO4Yosy5in7MfMVxS/UmocdiwmJxv/OizmQtd42Iu1tOQHF
        RujcC3ceeSp21nh7Ir9Rg2Ap6Cnu5DpCsIp3eh6v8fjCNk7EK96+7dgLGB11Ow/i
        8G7tVe8ktFsIMLgZCwkh5L4cV+Mil5GXdu7KdmkvXfn9lONCRlod2UikTp7lukql
        XIJLtiFvA5w0xVlDSa1RnouQZip26+AqR5z97dRqHPLpRuHE1se5vFZ2fwW0BUtp
        e5G0ojP4IX9TPNzEBKvapK994XoxZXzevfyO4W4YdGDoXjKwDwGvGfHQVb64G06f
        qkNj62fGJbA2xDEuZXLcP1UtpxAswGiyd5Pfaq0m/2W7FRbUrbTi+6z9N3hTMpuU
        2qTtksuoXelGRrnevWFOnK9bbiRTRfPm5osLARwUd4q/wxBfJ7I37uJRpo0yodKT
        l/bjuRFq8YRb5RX6A2aE/n+Hu2eshYNYPbhiBPG5tHL5Z4DxuCYCPCsDDp9Vb1T7
        QLnspVLerU+P1QhdjbNb5kfMl6ZZ8k6Fz/GSqgqxiSz5UrDjEIrxM2fFpxrOfS2y
        THKynLGXPmmqwZNEXDUL/rtn04XdOfMsA1LFads/Z3JsNghId+OnF1y3+YsnaPC6
        VIWCnwJUM6w5NI1q9bZZTMPGe7LWAhD3o62cii9kBHfNJgWuvM7BTQRfVz3YARAA
        005C7/hials8ORqob44HqAJi82GuUXyS/qGXZlN/XRqsRV0lHE7etqT0JdeoMWHX
        IvTDjZ8EPazx6BLgwylNcf3kuoozYvITwz6RNQ5iI2jIQ0clYwnplOsfBZLP+0CH
        fIXX5AB9D3t12Icb+dtvCwgrQ2TV+X6YWZ4DmldEuurZs/Xp0sACrORlNMG36N4K
        3v7/5jMIl13TSQvzBwr2/XGPmIXDGvoxjBk34Tny4k/f/xGTqMiKb5nT8QmDMnSt
        ToY8lPkdM+HaXiTgrlc00Hlqu7hK5qt7iwLL6yF15wBjjkJtlq1n9Esr5XcQa7nB
        eTSQ1CRGmW7qQ7wC8w+3MnpEEwT9irW2w81AKyfu7wMsQmKXB6Sk/IZaBDjoF/te
        RSIkV6hIHODHslzIvb5CLkjnkkrm/4jhCcSB2nZCbwutHi9MBiEaNHzuw/stoUzy
        inmUUrlSq4nnU7yU5PshOMWVeUfqYf59D0+51kZdhytmMfQ8xean/iC7jaa0chj4
        Aw95LZN0rn0ziTN/kJEVLus/DJnKbNUIC8wjWNTPoug/o12Q9I+e/BpemDDe9ezl
        HdxIhvNgLH6abpl+ahyAKMuU9DcNgSnDBzVo4w/7Xtf0nLF67Edq30q+PyM0CDQR
        7yn97tfC36WcHjIuaJUhHGmrzhNxn8wdlHai8i3sUPkAEQEAAcLDsgQYAQoAJhYh
        BNdc6hcEi5rL8YZ5SzJjfUTxT2IOBQJfVz3YAhsCBQkHhM4AAkAJEDJjfUTxT2IO
        wXQgBBkBCgAdFiEE29FFq2PqwL7mjwBNM+4xO62VibcFAl9XPdgACgkQM+4xO62V
        ibcKRg/9EAM+8dVszT5BnBfxM2aB1hcp21snB6wSMMnqmF3iKGdnPfNaCscYvGCg
        k8D8UUzokyICHNQC5ebUVjGlpQqoFiha7L+06aCDyfJ0xEpqs6ud7zFbjSU5N2xO
        KxclKiu53DwC7eBrGPA59PUmoQtE59h8QhTxr1sAJf7BVG96uj6a9FfylzpX+WpB
        5KTGxPnx4jbCNljz3MHtJGRIHywg0dL/8uopOPNVS89ES1fo9g5QsFSwUqql4hE+
        PCL8YvEyDohE87QACN3zWgZC5lQWNnNp5piWKEyT/njHeJwIbnbtmV/LQXKhW7wM
        khESRcV333Sb0rwUz8MQ/lvaqJxwIGSSsVCyasq33Nr3mCcxWjFCYkAeyHamu3a/
        N4uy2ZcFyOGKSpix2MT54Zn8UFPp4UUtjKmn0aZbJCugVxGatoxGDcZkUQu2BDej
        t2+3LKFpJJsptaXp6fKPoPlTJtvuCDy8B3i30TyW8gwYw39n8mC7wd6hgQmyXKQh
        CwcY2yVAOV/Kzcn8UKROciVMKjkawTKatMdd0JgubeZN79PBFExTnL3GLl9c+Wdg
        77TkF0tW0cmBSsFm+N3jUrlGz/jZA6rOVKmhuiHNAvE6UJyWU0DAYil0GO0rzB6m
        wo6exII/tSv15WAlIMNyVKdJJUtveOYe2ss6d9hJAVmv+1Pu+7JOUBAAnxkF4r4p
        yLR/sgT0z4pNw6zepFD8vWUpY98sWoo8JA4+nW+vvzZFh9JOAtVaG3xipIA9RPJS
        k4znSm2nkHLGvH+AJ8gNCWdQqEfE3TYfprxHlzNeRe97UQnEkzM3m+nbexOyuRlf
        cljFd1zoZFkxpzt4Zy38OaaArh6VZHWfxNozrEsHEXctJ8z6CBIf1kUVuKFPg9YV
        mu3jWN+5nwHRzug96DvnpUXmhVKOpxg1IgR4UbFAHkmibdqf6N8JIgf7A/0p11Kb
        lkmCej5ZsCZosb583rSCo0R+exEWFvDvU9cQ2mkFdzy+S4Y7JHcmBDWUL3KvQZOk
        5Rgj0835wO/jkEwgoB3ktooYkaeXMSGQoD22K9gbe8FZGKaRNX6XUYz6MdHLv/Wn
        5b8OjxOyUO8WQcCieUQK3rPXklWuzTFGESI3xjF7FZPK5tTkDMOUt93GdDm9D9uC
        fbghYwuZQUdQCCQ/0e9d6PVBfN3lHMeEQdunzJlkFliWyXEnUnKJMgZZrtvDyuR5
        peyEq4s/OyQZBKn2FtTAUEWDCb8gLFK7QKe/hOBX4S/76PKv/uInUahqwv8RdSRI
        oCWXNBttL61jaL9hgQ23sM7slNLHsQ1ESPQOrXjLhVStwp3+y+61STyz/jPQ9ARG
        1tEmRW9Yc+su6LFr6q31hYae1sKKwakAMBk=
        =qVie
        -----END PGP PUBLIC KEY BLOCK-----
      mode: '0644'
    register: vector_apt_gpg_key
    when:
      - ansible_os_family | lower == "debian"

  - name: Import Vector APT GPG key
    ansible.builtin.shell: |
      cat "/tmp/DATADOG_APT_KEY_CURRENT.public" | gpg --import --batch --no-default-keyring --keyring "/usr/share/keyrings/datadog-archive-keyring.gpg"
    when:
      - ansible_os_family | lower == "debian"
      - vector_apt_gpg_key.changed

  - name: Remove temporary Vector YUM GPG key
    ansible.builtin.file:
      path: /tmp/DATADOG_RPM_KEY_CURRENT.public
      state: absent
    when:
      - ansible_os_family | lower == "redhat" or ansible_os_family | lower == "suse"

  - name: Remove temporary Vector APT GPG key
    ansible.builtin.file:
      path: /tmp/DATADOG_APT_KEY_CURRENT.public
      state: absent
    when:
      - ansible_os_family | lower == "debian"
...

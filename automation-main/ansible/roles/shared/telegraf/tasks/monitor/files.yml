---
  - name: '[File Monitor] Include the vars file for the requested profile: {{ profile | replace("_", "-") }}'
    ansible.builtin.include_vars:
      file: "{{lookup('first_found', params)}}"
    vars:
      params:
        files:
          - '{{ profile | replace("_", "-") }}.yml'
          - notfound.yml
        paths:
          - vars/files

  - name: BLOCK - Only write file to disk if variable monitor_files has items
    when:
      - monitor_files is defined
      - monitor_files | length > 0
    become: true
    block:
      - name: '[File Monitor] - Write the file monitoring rules to disk for {{ profile | replace("_", "-") }}'
        ansible.builtin.template:
          src: monitor-files.conf.j2
          dest: /etc/telegraf/telegraf.d/monitor-files-{{ profile | replace("_", "-") }}.conf
          selevel: s0
          seuser: system_u
          setype: etc_t
          serole: object_r
          owner: root
          group: root
          mode: '0644'
        notify:
          - restart telegraf
...
